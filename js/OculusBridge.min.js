/*! OculusBridge 2013-07-30 */
var OculusBridge=function(a){var b,c=!0,d=a.hasOwnProperty("address")?a.address:"localhost",e=a.hasOwnProperty("port")?a.port:9005,f=a.hasOwnProperty("retryInterval")?a.retryInterval:1,g=a.hasOwnProperty("debug")?a.debug:!1,h={x:0,y:0,z:0,w:0},i={FOV:125.871,hScreenSize:.14976,vScreenSize:.0935,vScreenCenter:.04675,eyeToScreenDistance:.041,lensSeparationDistance:.067,interpupillaryDistance:.0675,hResolution:1280,vResolution:720,distortionK:[1,.22,.24,0],chromaAbParameter:[.996,-.004,1.014,0]},j={onOrientationUpdate:null,onConfigUpdate:null,onConnect:null,onDisconnect:null};for(var k in j)"function"==typeof a[k]&&(j[k]=a[k]);var l=function(a){a.o&&4==a.o.length&&(h.x=Number(a.o[1]),h.y=Number(a.o[2]),h.z=Number(a.o[3]),h.w=Number(a.o[0]),j.onOrientationUpdate&&j.onOrientationUpdate(h))},m=function(a){i.hScreenSize=a.screenSize[0],i.vScreenSize=a.screenSize[1],i.vScreenCenter=a.screenSize[1]/2,i.eyeToScreenDistance=a.eyeToScreen,i.lensSeparationDistance=a.lensDistance,i.interpupillaryDistance=a.interpupillaryDistance,i.hResolution=a.screenResolution[0],i.vResolution=a.screenResolution[1],i.distortionK=[a.distortion[0],a.distortion[1],a.distortion[2],a.distortion[3]],i.FOV=a.fov,j.onConfigUpdate&&j.onConfigUpdate(i)},n=function(){c=!0;var a="ws://"+d+":"+e+"/";b=new WebSocket(a),o("Attempting to connect: "+a),b.onopen=function(){o("Connected!"),j.onConnect&&j.onConnect()},b.onerror=function(){o("Socket error.")},b.onmessage=function(a){var b=JSON.parse(a.data),c=b.m;switch(c){case"config":m(b);break;case"orientation":l(b);break;default:o("Unknown message received from server: "+a.data),q()}},b.onclose=function(){j.onDisconnect&&j.onDisconnect(),c&&(o("Connection failed, retrying in 1 second..."),window.setTimeout(p,1e3*f))}},o=function(a){g&&console.log("OculusBridge: "+a)},p=function(){n()},q=function(){c=!1,b.close()},r=function(){return i},s=function(){return h},t=function(){return 1==b.readyState};return{isConnected:t,disconnect:q,connect:n,getOrientation:s,getConfiguration:r}};